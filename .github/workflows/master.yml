name: Build

on:
  pull_request:
    paths-ignore:
      - '**.md'
  push:
    paths-ignore:
      - '**.md'
    branches:
      - main
    tags:
      - v**

jobs:
  demo_app_authentication:
    runs-on: ubuntu-latest
    steps:
      - name: Generate a token
        id: generate-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ vars.APP_ID }}
          private-key: ${{ secrets.PRIVATE_KEY }}
          owner: Saturday-Morning-Publishing-LLC
          repo: demo-backend-org
      - name: Use the token
        env:
          GH_TOKEN: ${{ steps.generate-token.outputs.token }}
        run: |
          echo ${{ steps.generate-token.outputs.token }}
          gh api octocat
      - name: Build Web app
        run: |
          echo "Build Web app"
          sleep 10s
      - uses: convictional/trigger-workflow-and-wait@v1.3.0
        with: 
          owner: Saturday-Morning-Publishing-LLC
          repo: demo-backend-org
          ref: demo-branch
          github_token: ${{ steps.generate-token.outputs.token }}
          workflow_file_name: deploy.yml
          inputs: '{"version":"2.1.3.0"}'
      - name: Some more steps here app
        run: |
          echo "Some more steps here app"
          sleep 10s


  #  build-docker:
  #  name: Build docker image
  #  runs-on: ubuntu-latest
  #  steps:
  #    - name: Build Web app
  #      run: |
  #        echo "Build Web app"
  #        sleep 10s
  #    - uses: convictional/trigger-workflow-and-wait@v1.3.0
  #      with: 
  #        owner: Saturday-Morning-Publishing-LLC
  #        repo: demo-backend-org
  #        ref: demo-branch
  #        github_token: 3c496393274f9ed672afb496f2b5e91ad2cafea7
  #        workflow_file_name: deploy.yml
  #        inputs: '{"version":"1.0"}'
  #    - name: Build Web app
  #      run: |
  #        echo "Build Web app"
  #        sleep 10s 

      